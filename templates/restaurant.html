{% extends "layout.html" %}
{% block content %}
    <h2>{{ restaurant.name }}</h2>
    <p>Osoite: {{ restaurant.address }}</p>
    <p>Nettisivu: <a href="{{ restaurant.link }}">{{ restaurant.link }}</a></p>
    <p>Tagit:
        {% for tag in restaurant_tags %}
            <span>
                {{ tag.name }}
                <form action="/remove_tag_from_restaurant" method="post" style="display:inline;">
                    <input type="hidden" name="restaurant_id" value="{{ restaurant.id }}">
                    <input type="hidden" name="tag_id" value="{{ tag.id }}">
                    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
                    <button type="submit" style="border:none; background:none; color:red; cursor:pointer;">✖</button>
                </form>
                {% if not loop.last %}, {% endif %}
            </span>
        {% endfor %}
    </p>
    {% if session.user_id == restaurant.user_id %}
    <p>
        <a href="/edit_restaurant/{{ restaurant.id }}">
            <button type="button">Muokkaa ravintolaa</button>
        </a>
    </p>

    <p>
        <a href="/remove_restaurant/{{ restaurant.id }}"> 
            <button type="button">Poista ravintola</button>
        </a>
    </p>
    {% endif %}
    
    
        <h3>Lisää tageja</h3>
        <form action="/add_tags/{{ restaurant.id }}" method="post">
            {% for tag in tags %}
            <input type="checkbox" name="tags" value="{{ tag.id }}"> {{ tag.name }} <br>
            {% endfor %}
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
            <input type="submit" value="Lisää tagit">
        </form>

    <h3>Luo uusi tagi</h3>
  <form action="/create_tag" method="post">
    <input type="text" name="new_tag_name" placeholder="Esim. vegaaninen" required/>
    <input type="submit" value="Lisää tagi" />
    <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
  </form>
  <p>

  </p>
  <a href="/restaurants">Takaisin ravintoloihin</a>
    {% if session.user_id %}
    <p>
        <a href="/add_review/{{ restaurant.id }}">
            <button type="button">Lisää arvostelu</button>
        </a>
    </p>
    {% endif %}
    
    <h3>Arvostelut</h3>
    {% if reviews %}
    
    <div class="reviews">
        {% for review in reviews %}
        
            <div class="review-card">
                <p><strong>{{ review.username}} {{ review.created_at}}</strong></p>
                <p>{{ review.comment }} - {{ review.rating }} tähteä</p>
                {% if session.user_id == review.user_id %}
                    <p>
                        <a href="/edit_review/{{ review.id }}">
                            <button type="button">Muokkaa arvostelua</button>
                        </a>
                    </p>
                    <p>
                        <a href="/remove_review/{{ review.id }}">
                            <button type="button">Poista arvostelu</button>
                        </a>
                    </p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Ei arvosteluja</p>
    {% endif %}
{% endblock %}